name: Deploy Full Stack App

on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        
      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'yarn'
          
      - name: Install dependencies
        run: yarn install --frozen-lockfile
        
      - name: Check project structure
        run: |
                  echo "=== Dependencies check ==="
          if [ -f "package.json" ]; then
            echo "React version: $(grep '"react"' package.json)"
            echo "Redux version: $(grep '"react-redux"' package.json || echo 'Not found')"
          fi
        
      - name: Build project
        run: yarn build
        
      - name: Final verification
        run: |
          echo "=== Final build check ==="
          if [ -f "dist/index.html" ]; then
            echo "✅ Build successful"
            echo "=== Main bundle size ==="
            find dist/assets -name "*.js" -exec du -h {} \; | sort -hr | head -5
          else
            echo "❌ Build failed"
            exit 1
          fi
        
      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./dist

          echo "=== Project structure ==="
          find src/ -name "*.js" -o -name "*.jsx" | head -20
          echo "=== Store files ==="
          find src/ -name "*store*" -o -name "*redux*" 2>/dev/null || echo "No store files found
